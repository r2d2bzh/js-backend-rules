# DO NOT EDIT THIS FILE AS IT IS GENERATED BY @r2d2bzh/js-backend-rules
# If you need to customize the compose configuration, please use docker-compose.override.yml
# More details are available here:
# - https://docs.docker.com/compose/reference/#specifying-multiple-compose-files
# - https://docs.docker.com/compose/extends/#adding-and-overriding-configuration
# - https://github.com/compose-spec/compose-spec/blob/master/spec.md
services:
  service-a:
    build: &ref_0
      context: ./dev
      args:
        UID: '${UID}'
        GID: '${GID}'
        DOCKER_BUILD_NODEJS_VERSION: '${DOCKER_BUILD_NODEJS_VERSION}'
    depends_on:
      - nats
    volumes:
      - './service-a:/home/user/dev'
    command:
      - npm
      - start
    ports:
      - 9229
  service-a.rel:
    image: 'https:/test-registry/fake/webservices/api-service-a:${VERSION:-dev}'
    build:
      context: ./service-a
      args:
        DOCKER_BUILD_NODEJS_VERSION: '${DOCKER_BUILD_NODEJS_VERSION}'
    depends_on:
      - nats
  service-b:
    build: *ref_0
    depends_on:
      - nats
    volumes:
      - './service-b:/home/user/dev'
    command:
      - npm
      - start
    ports:
      - 9229
  service-b.rel:
    image: 'https:/test-registry/fake/webservices/api-service-b:${VERSION:-dev}'
    build:
      context: ./service-b
      args:
        DOCKER_BUILD_NODEJS_VERSION: '${DOCKER_BUILD_NODEJS_VERSION}'
    depends_on:
      - nats
  test:
    build: *ref_0
    volumes: &ref_1
      - './test:/home/user/dev'
      - './service-a:/home/user/service-a'
      - './service-b:/home/user/service-b'
    profiles:
      - test
    entrypoint:
      - npm
      - run
    command:
      - cov
  _test:
    build: *ref_0
    volumes: *ref_1
    ports:
      - 9229
  nats:
    image: 'https:/test-registry/fake/thirdparties/nats:1.1.3'
